<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ORDO Â· Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
/* Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
::-webkit-scrollbar {
  width: var(--scrollbar-size);
  height: var(--scrollbar-size);
}

/* Ø§Ù„Ù…Ø³Ø§Ø± */
::-webkit-scrollbar-track {
  background: var(--scrollbar-bg);
  border-radius: 20px;
  backdrop-filter: blur(6px);
  box-shadow: inset 0 0 6px rgba(0,0,0,0.08);
}

/* Ø§Ù„Ù…Ù‚Ø¨Ø¶ */
::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: 20px;
  border: 2px solid transparent;
  background-clip: padding-box;
  transition: 
    transform 0.25s ease,
    background 0.25s ease,
    box-shadow 0.25s ease;
  box-shadow:
    0 0 0px transparent,
    0 2px 8px rgba(0,0,0,0.15);
}

/* ØªØ£Ø«ÙŠØ± Hover */
::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover);
  transform: scale(1.15);
  box-shadow:
    0 0 12px var(--scrollbar-glow),
    0 4px 12px rgba(0,0,0,0.25);
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ */
::-webkit-scrollbar-thumb:active {
  transform: scale(1.05);
  box-shadow:
    0 0 16px var(--scrollbar-glow),
    inset 0 0 4px rgba(0,0,0,0.2);
}

/* Ø²ÙˆØ§ÙŠØ§ Ø§Ù„ØªÙ‚Ø§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· */
::-webkit-scrollbar-corner {
  background: transparent;
}

/* Ø¯Ø¹Ù… ÙØ§ÙŠØ±ÙÙˆÙƒØ³ */
* {
  scrollbar-width: thin;
  scrollbar-color: #1b5e42 rgba(0,0,0,0.05);
}

:root{--g:#1b5e42;--gl:#236b50;--gd:#133d2c;--accent:#c8a84b;--w:#fff;--off:#f4f6f5;--text:#1a2a22;--muted:#5a7066;--b:#dde6e2;--red:#c62828;--blue:#1565c0;--sw:260px}
html,body{height:100%;font-family:'Cairo','Tajawal',sans-serif;direction:rtl;background:var(--off);color:var(--text);overflow-x:hidden}
.sb{position:fixed;top:0;right:0;width:var(--sw);height:100vh;background:var(--gd);display:flex;flex-direction:column;z-index:100;overflow-y:auto}
.sb-brand{padding:1.5rem;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;gap:0.8rem}
.sb-logo{font-family:'Tajawal',sans-serif;font-size:1.5rem;font-weight:800;color:var(--w);letter-spacing:3px}
.sb-flag{width:22px;height:15px;border-radius:2px;object-fit:cover}
.sb-user{padding:1.2rem 1.5rem;border-bottom:1px solid rgba(255,255,255,0.06)}
.sb-av-wrap{cursor:pointer;position:relative;width:48px;margin-bottom:0.8rem}
.sb-av{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#e8c56a);display:flex;align-items:center;justify-content:center;font-family:'Tajawal',sans-serif;font-size:1.2rem;font-weight:800;color:var(--w)}
.sb-av-img{width:48px;height:48px;border-radius:50%;object-fit:cover;position:absolute;top:0;left:0;display:none;border:2px solid rgba(200,168,75,0.4)}
.sb-av-edit{position:absolute;bottom:-2px;left:-2px;width:18px;height:18px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid var(--gd)}
.sb-name{font-size:.9rem;font-weight:700;color:var(--w);margin-bottom:.2rem}
.sb-type{font-size:.72rem;color:var(--accent);font-weight:500}
.sb-nin{font-size:.68rem;color:rgba(255,255,255,0.35);margin-top:.2rem;font-family:'Tajawal',sans-serif;letter-spacing:.5px}
.sb-nav{flex:1;padding:1rem 0}
.ngl{font-size:.62rem;font-weight:700;color:rgba(255,255,255,0.25);text-transform:uppercase;letter-spacing:2px;padding:.8rem 1.5rem .4rem}
.ni{display:flex;align-items:center;gap:.9rem;padding:.75rem 1.5rem;color:rgba(255,255,255,0.65);font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s;border-right:3px solid transparent;text-decoration:none}
.ni i{width:20px;text-align:center;font-size:.9rem;color:rgba(255,255,255,0.45)}
.ni:hover{color:var(--w);background:rgba(255,255,255,0.05)}
.ni.act{color:var(--w);background:rgba(255,255,255,0.08);border-right-color:var(--accent)}
.ni.act i{color:var(--accent)}
.sb-bot{padding:1rem 1.5rem;border-top:1px solid rgba(255,255,255,0.06)}
.logout-btn{display:flex;align-items:center;gap:.8rem;color:rgba(255,255,255,0.45);font-size:.82rem;cursor:pointer;transition:color .2s;padding:.5rem 0;background:none;border:none;font-family:'Cairo',sans-serif;width:100%}
.logout-btn:hover{color:var(--red)}
.main{margin-right:var(--sw);min-height:100vh;display:flex;flex-direction:column}
.topbar{background:var(--w);border-bottom:1px solid var(--b);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar-title{font-family:'Tajawal',sans-serif;font-size:1.2rem;font-weight:800;color:var(--text)}
.notif-btn{width:38px;height:38px;border-radius:8px;background:var(--off);border:1px solid var(--b);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted);position:relative;transition:all .2s}
.notif-btn:hover{border-color:var(--g);color:var(--g)}
.notif-dot{position:absolute;top:6px;right:6px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid var(--w)}
.content{padding:2rem;flex:1}
.page{display:none}.page.act{display:block}
.welcome-bar{background:linear-gradient(135deg,var(--g),var(--gl));border-radius:16px;padding:2rem;color:var(--w);margin-bottom:2rem;position:relative;overflow:hidden}
.welcome-bar::after{content:'ORDO';position:absolute;left:-10px;top:50%;transform:translateY(-50%);font-family:'Tajawal',sans-serif;font-size:6rem;font-weight:800;color:rgba(255,255,255,.05);pointer-events:none}
.welcome-title{font-family:'Tajawal',sans-serif;font-size:1.5rem;font-weight:800;margin-bottom:.4rem}
.welcome-title span{color:var(--accent)}
.welcome-sub{font-size:.85rem;opacity:.7;font-weight:300}
.qcards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1.2rem;margin-bottom:2rem}
.qc{background:var(--w);border:1px solid var(--b);border-radius:14px;padding:1.5rem;cursor:pointer;transition:all .25s}
.qc:hover{border-color:var(--g);box-shadow:0 6px 20px rgba(27,94,66,.1);transform:translateY(-3px)}
.qc-ico{width:46px;height:46px;border-radius:12px;background:rgba(27,94,66,.07);display:flex;align-items:center;justify-content:center;color:var(--g);font-size:1.2rem;margin-bottom:1rem}
.qc h4{font-size:.88rem;font-weight:700;color:var(--text);margin-bottom:.2rem}
.qc p{font-size:.75rem;color:var(--muted)}
.sec-lbl{font-size:.72rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:1rem;display:block}
.act-list{background:var(--w);border:1px solid var(--b);border-radius:14px;overflow:hidden}
.act-item{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;border-bottom:1px solid var(--b);transition:background .2s}
.act-item:last-child{border-bottom:none}
.act-item:hover{background:var(--off)}
.act-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:.95rem;flex-shrink:0}
.act-txt{flex:1}
.act-txt strong{display:block;font-size:.85rem;font-weight:700;color:var(--text);margin-bottom:.15rem}
.act-txt span{font-size:.75rem;color:var(--muted)}
.act-st{font-size:.7rem;font-weight:700;padding:.2rem .6rem;border-radius:50px;white-space:nowrap}
.sp{background:rgba(255,152,0,.1);color:#e65100}
.sd{background:rgba(27,94,66,.1);color:var(--g)}
.sc{background:rgba(198,40,40,.08);color:var(--red)}
/* WALLET */
.w-container{background:linear-gradient(135deg,#0a1a10,#112b1e);border-radius:24px;padding:2rem 2rem 1.5rem;position:relative;overflow:hidden;margin-bottom:2rem}
.w-container::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 80%,rgba(200,168,75,.07),transparent 55%),radial-gradient(ellipse at 80% 10%,rgba(27,94,66,.15),transparent 50%);pointer-events:none}
.w-tabs{display:flex;gap:.5rem;margin-bottom:1.5rem;position:relative;z-index:2}
.wtab{flex:1;padding:.55rem .5rem;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:rgba(255,255,255,.45);font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:700;cursor:pointer;transition:all .25s;text-align:center;display:flex;flex-direction:column;align-items:center;gap:.3rem}
.wtab i{font-size:1rem}
.wtab:hover{background:rgba(255,255,255,.1);color:rgba(255,255,255,.7)}
.wtab.act{border-color:var(--accent);background:rgba(200,168,75,.12);color:var(--accent)}
.tsdot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.15);margin:0 auto;transition:background .3s}
.wtab.has-doc .tsdot{background:#4ade80}
.flip-scene {
  perspective: 1500px; /* ÙŠØ¹Ø·ÙŠ Ø¹Ù…Ù‚Ø§Ù‹ Ø¨ØµØ±ÙŠØ§Ù‹ Ù„Ù„Ø­Ø±ÙƒØ© */
  width: 100%;
  height: 230px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.flip-card {
  width: 360px;
  height: 210px;
  position: relative;
  transform-style: preserve-3d; /* Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª ÙƒÙ€ 3D */
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
}
.flip-card.flipped {
  transform: rotateY(180deg);
}
.flip-face{position:absolute;inset:0;border-radius:20px;overflow:hidden;transition:opacity .35s ease,transform .35s ease}
.flip-face-front{opacity:1;transform:scale(1);pointer-events:auto}
.flip-face-back{opacity:0;transform:scale(.96);pointer-events:none}
.flip-card.flipped .flip-face-front{opacity:0;transform:scale(.96);pointer-events:none}
.flip-card.flipped .flip-face-back{opacity:1;transform:scale(1);pointer-events:auto}
.card-face{width:100%;height:100%;position:relative}
.bg-nin{background:linear-gradient(140deg,#0f3d28 0%,#1b6645 60%,#2a8a5a 100%)}
.bg-chifa{background:linear-gradient(140deg,#5c1010 0%,#8b2020 60%,#b03535 100%)}
.bg-permis{background:linear-gradient(140deg,#0d2150 0%,#1a3a80 60%,#2456b8 100%)}
.bg-nin-b{background:linear-gradient(140deg,#092414,#0f3d28)}
.bg-chifa-b{background:linear-gradient(140deg,#3a0a0a,#5c1818)}
.bg-permis-b{background:linear-gradient(140deg,#071230,#0d2150)}
.face-img{position:absolute;inset:0;z-index:1;border-radius:20px;overflow:hidden;display:none}
.face-img.show{display:block}
.face-img img{width:100%;height:100%;object-fit:cover;display:block}
/* delete button on wallet card */
.card-del-btn{position:absolute;top:8px;left:8px;z-index:10;width:28px;height:28px;border-radius:50%;background:rgba(198,40,40,0.85);border:2px solid rgba(255,255,255,0.5);color:#fff;font-size:0.65rem;cursor:pointer;display:none;align-items:center;justify-content:center;transition:all 0.2s;backdrop-filter:blur(4px)}
.card-del-btn:hover{background:var(--red);transform:scale(1.1)}
.face-img.show + .face-upload + .card-deco ~ .card-del-btn{display:flex}
.face-img.show ~ .card-del-btn{display:flex}
.face-upload{position:absolute;inset:0;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.5rem;border:2px dashed rgba(255,255,255,.2);border-radius:20px;cursor:pointer;transition:all .25s;background:rgba(0,0,0,.15)}
.face-upload:hover{border-color:rgba(200,168,75,.6);background:rgba(200,168,75,.06)}
.face-upload .u-ico{font-size:1.8rem;color:rgba(255,255,255,.25);transition:color .2s}
.face-upload:hover .u-ico{color:rgba(200,168,75,.7)}
.face-upload .u-txt{font-family:'Cairo',sans-serif;font-size:.72rem;font-weight:700;color:rgba(255,255,255,.35)}
.face-upload:hover .u-txt{color:rgba(200,168,75,.8)}
.face-upload.hidden{display:none}
.card-deco{position:absolute;inset:0;z-index:3;pointer-events:none;border-radius:20px;background:linear-gradient(to bottom,rgba(0,0,0,.22) 0%,transparent 40%,transparent 60%,rgba(0,0,0,.35) 100%)}
.deco-top{position:absolute;top:0;left:0;right:0;padding:.85rem 1.1rem;display:flex;align-items:center;justify-content:space-between}
.deco-lbl{font-family:'Tajawal',sans-serif;font-size:.58rem;font-weight:700;color:rgba(255,255,255,.6);letter-spacing:1px;text-shadow:0 1px 4px rgba(0,0,0,.5)}
.card-chip{width:30px;height:22px;border-radius:4px;background:linear-gradient(135deg,#d4af37,#f5d96b);opacity:.9}
.card-chip::after{content:'';display:block;width:18px;height:14px;border:1.5px solid rgba(100,70,0,.5);border-radius:2px;margin:4px auto}
.deco-bot{position:absolute;bottom:0;left:0;right:0;padding:.75rem 1.1rem;display:flex;align-items:flex-end;justify-content:space-between}
.card-num{font-family:'Tajawal',sans-serif;font-size:.85rem;font-weight:800;color:rgba(255,255,255,.85);letter-spacing:2.5px;text-shadow:0 1px 6px rgba(0,0,0,.8)}
.card-bw{text-align:left}
.card-badge{font-size:.55rem;font-weight:700;color:rgba(255,255,255,.5);letter-spacing:.8px;display:block;text-shadow:0 1px 4px rgba(0,0,0,.7)}
.card-flag{font-size:1.1rem;display:block}
.back-stripe{height:34px;background:rgba(0,0,0,.6);position:absolute;top:28px;left:0;right:0;z-index:4}
.back-sig{height:24px;background:rgba(255,255,255,.8);border-radius:3px;position:absolute;top:76px;left:14px;right:14px;z-index:4}
.back-bot{position:absolute;bottom:0;left:0;right:0;padding:.6rem 1rem;display:flex;justify-content:space-between;align-items:center;z-index:4}
.back-lbl{font-family:'Tajawal',sans-serif;font-size:.58rem;color:rgba(255,255,255,.25);letter-spacing:1px}
.flip-hint{display:flex;align-items:center;justify-content:center;gap:.6rem;margin-top:.9rem;z-index:2;position:relative}
.flip-hint-txt{font-family:'Cairo',sans-serif;font-size:.72rem;font-weight:700;color:rgba(255,255,255,.28)}
.flip-arrows{display:flex;gap:.4rem}
.farr{width:32px;height:32px;border-radius:50%;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.08);color:rgba(255,255,255,.5);font-size:.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.farr:hover{background:rgba(255,255,255,.18);color:var(--w)}
.side-dots{display:flex;gap:.5rem;margin-top:.6rem;justify-content:center;z-index:2;position:relative}
.sdot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.15);transition:all .3s;cursor:pointer}
.sdot:hover{background:rgba(255,255,255,.3);transform:scale(1.4)}
.sdot.act{background:var(--accent);width:20px;border-radius:3px;box-shadow:0 0 12px rgba(200,168,75,.8)}
.w-actions{display:flex;gap:.8rem;margin-top:1.2rem;justify-content:center;z-index:2;position:relative}
.w-save-btn{padding:.75rem 1.8rem;background:linear-gradient(135deg,var(--accent),#d4a849);color:#000;border:none;border-radius:10px;font-family:'Cairo',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:.6rem;box-shadow:0 6px 20px rgba(200,168,75,.3)}
.w-save-btn:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(200,168,75,.5)}
/* PROFILE */
.p-layout{display:grid;grid-template-columns:300px 1fr;gap:2rem;align-items:start}
.p-card{background:var(--w);border:1px solid var(--b);border-radius:16px;padding:2rem;text-align:center}
.p-av-wrap{position:relative;width:100px;margin:0 auto 1.2rem}
.p-av{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,var(--g),var(--accent));display:flex;align-items:center;justify-content:center;font-family:'Tajawal',sans-serif;font-size:2.5rem;font-weight:800;color:var(--w)}
.p-av-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid var(--accent);position:absolute;top:0;left:0;display:none}
.av-edit{position:absolute;bottom:0;left:0;width:28px;height:28px;background:var(--g);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--w);font-size:.65rem;cursor:pointer;border:2px solid var(--w)}
.p-name{font-family:'Tajawal',sans-serif;font-size:1.2rem;font-weight:800;color:var(--text);margin-bottom:.2rem}
.p-type{font-size:.78rem;color:var(--accent);font-weight:600;margin-bottom:.3rem}
.p-nin{font-size:.72rem;color:var(--muted);margin-bottom:1.2rem}
.p-stats{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;border-top:1px solid var(--b);padding-top:1.2rem}
.pst{text-align:center}
.pst strong{display:block;font-size:1.4rem;font-weight:800;color:var(--g)}
.pst span{font-size:.72rem;color:var(--muted)}
.e-card{background:var(--w);border:1px solid var(--b);border-radius:16px;padding:2rem}
.e-card h3{font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:800;color:var(--text);margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--b)}
.fg{margin-bottom:1.1rem}
.fg label{display:block;font-size:.76rem;font-weight:700;color:var(--text);margin-bottom:.4rem}
.field{width:100%;padding:.8rem 1rem;border:1.5px solid var(--b);border-radius:10px;font-family:'Cairo',sans-serif;font-size:.88rem;color:var(--text);background:var(--w);transition:all .2s;outline:none;appearance:none;-webkit-appearance:none}
.field:focus{border-color:var(--g);box-shadow:0 0 0 3px rgba(27,94,66,.07)}
.field:disabled{background:var(--off);color:var(--muted);cursor:not-allowed}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.fsect{font-size:.8rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
.fsect i{color:var(--g)}
.hr{border:none;border-top:1px solid var(--b);margin:1.5rem 0}
.save-btn{padding:.85rem 2rem;background:var(--g);color:var(--w);border:none;border-radius:10px;font-family:'Cairo',sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:.6rem}
.save-btn:hover{background:var(--gd);transform:translateY(-2px);box-shadow:0 6px 18px rgba(27,94,66,.2)}
.saved-msg{display:none;color:var(--g);font-size:.8rem;font-weight:600;margin-top:.5rem;align-items:center;gap:.4rem}
/* SCAN */
.scan-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
.sc-card{background:var(--w);border:1px solid var(--b);border-radius:16px;padding:2rem;position:relative;transition:all .25s}
.sc-card:hover{border-color:var(--g)}
.sc-card.full{grid-column:span 2}
.sc-hdr{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}
.sc-ico{width:54px;height:54px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.4rem}
.sc-ico.n{background:rgba(27,94,66,.08);color:var(--g)}
.sc-ico.c{background:rgba(200,168,75,.1);color:var(--accent)}
.sc-ico.p{background:rgba(21,101,192,.08);color:var(--blue)}
.sc-ico.o{background:rgba(33,150,243,.08);color:#1565c0}
.sc-title{font-family:'Tajawal',sans-serif;font-size:1.05rem;font-weight:800;color:var(--text)}
.sc-sub{font-size:.75rem;color:var(--muted)}
.sc-mtabs{display:flex;gap:.5rem;margin-bottom:1.5rem}
.sm{flex:1;padding:.6rem;border:1.5px solid var(--b);border-radius:8px;font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:700;color:var(--muted);cursor:pointer;text-align:center;transition:all .2s;background:none}
.sm.act{border-color:var(--g);color:var(--g);background:rgba(27,94,66,.05)}
.sv{display:none}.sv.act{display:block}
.scan-zone{border:2px dashed var(--b);border-radius:14px;padding:2rem;text-align:center;cursor:pointer;transition:all .3s}
.scan-zone:hover{border-color:var(--g);background:rgba(27,94,66,.02)}
.scan-zone.drag-over{border-color:var(--accent);background:rgba(200,168,75,.04)}
.scan-zone i{font-size:2.5rem;color:var(--b);margin-bottom:1rem;display:block}
.scan-zone p{font-size:.82rem;color:var(--muted);margin-bottom:.4rem}
.scan-zone small{font-size:.72rem;color:rgba(90,112,102,.6)}
.scan-prev{margin-top:1rem;display:none;position:relative}
.scan-prev img{width:100%;border-radius:10px;max-height:200px;object-fit:contain;border:1px solid var(--b)}
.scan-prev-del{position:absolute;top:8px;left:8px;width:28px;height:28px;background:rgba(198,40,40,.9);border-radius:50%;border:none;color:var(--w);font-size:.7rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.ph-scan{background:var(--off);border-radius:14px;padding:2rem;text-align:center}
.ph-qr{width:120px;height:120px;background:var(--w);border:1px solid var(--b);border-radius:10px;margin:0 auto 1rem;display:flex;align-items:center;justify-content:center;font-size:3rem;color:var(--b)}
.cam-btn{padding:.8rem 1.5rem;background:var(--g);color:var(--w);border:none;border-radius:8px;font-family:'Cairo',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;margin-top:1rem;display:inline-flex;align-items:center;gap:.5rem;transition:all .2s}
.cam-btn:hover{filter:brightness(.9)}
.doc-st{margin-top:1rem;padding:.8rem 1rem;border-radius:10px;font-size:.8rem;font-weight:600;display:none}
.doc-st.ok{background:rgba(27,94,66,.08);color:var(--g);border:1px solid rgba(27,94,66,.15)}
.df{margin-bottom:.8rem}
.df label{display:block;font-size:.73rem;font-weight:700;color:var(--muted);margin-bottom:.3rem;text-transform:uppercase;letter-spacing:.5px}
.df input,.df select{width:100%;padding:.65rem .9rem;border:1.5px solid var(--b);border-radius:8px;font-family:'Cairo',sans-serif;font-size:.85rem;color:var(--text);outline:none;transition:border .2s;background:var(--w);appearance:none;-webkit-appearance:none}
.df input:focus,.df select:focus{border-color:var(--g)}
.doc-save-btn{padding:.75rem 1.5rem;background:var(--g);color:var(--w);border:none;border-radius:8px;font-family:'Cairo',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;margin-top:1rem;display:flex;align-items:center;gap:.5rem;transition:all .2s;width:100%;justify-content:center}
.doc-save-btn:hover{filter:brightness(.9)}
.doc-del-btn{padding:.5rem 1rem;background:rgba(198,40,40,.08);color:var(--red);border:1px solid rgba(198,40,40,.2);border-radius:8px;font-family:'Cairo',sans-serif;font-size:.8rem;font-weight:700;cursor:pointer;margin-top:.5rem;display:flex;align-items:center;gap:.5rem;transition:all .2s;width:100%;justify-content:center}
.doc-del-btn:hover{background:rgba(198,40,40,.15)}
.doc-badge{position:absolute;top:1rem;left:1rem;background:var(--g);color:var(--w);font-size:.65rem;font-weight:700;padding:.2rem .7rem;border-radius:50px;display:none;align-items:center;gap:.3rem}
.doc-badge.show{display:flex}
/* AVATAR MODAL */
.av-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.av-modal.open{display:flex}
.av-modal-box{background:var(--w);border-radius:20px;padding:2rem;width:340px;max-width:95vw;box-shadow:0 30px 80px rgba(0,0,0,.25)}
.av-modal-title{font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:800;color:var(--text);margin-bottom:1.5rem;display:flex;align-items:center;gap:.6rem}
.av-prev-wrap{width:120px;height:120px;border-radius:50%;margin:0 auto 1.5rem;overflow:hidden;background:var(--off);border:3px dashed var(--b);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:border-color .2s}
.av-prev-wrap:hover{border-color:var(--g)}
.av-prev-wrap img{width:100%;height:100%;object-fit:cover;display:none}
.av-placeholder{font-size:2.5rem;color:var(--b)}
.av-drop{border:2px dashed var(--b);border-radius:12px;padding:1.5rem;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.av-drop:hover{border-color:var(--g);background:rgba(27,94,66,.03)}
.av-drop i{font-size:2rem;color:var(--b);display:block;margin-bottom:.5rem}
.av-drop p{font-size:.82rem;color:var(--muted)}
.av-acts{display:flex;gap:.8rem}
.av-save{flex:1;padding:.8rem;background:var(--g);color:var(--w);border:none;border-radius:10px;font-family:'Cairo',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;transition:all .2s}
.av-save:hover{background:var(--gd)}
.av-cancel{padding:.8rem 1.2rem;background:var(--off);color:var(--muted);border:1px solid var(--b);border-radius:10px;font-family:'Cairo',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);color:var(--w);padding:.9rem 2rem;border-radius:50px;font-size:.85rem;font-weight:600;box-shadow:0 8px 30px rgba(0,0,0,.2);transition:transform .4s cubic-bezier(.34,1.56,.64,1);z-index:9999;display:flex;align-items:center;gap:.6rem;white-space:nowrap}
.toast.show{transform:translateX(-50%) translateY(0)}
/* HAMBURGER + OVERLAY */
.ham-btn{display:none;width:42px;height:42px;border-radius:10px;border:1.5px solid var(--b);background:var(--off);align-items:center;justify-content:center;cursor:pointer;color:var(--text);font-size:1.05rem;flex-shrink:0}
.sb-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:98;backdrop-filter:blur(2px)}

@media(max-width:900px){
  .sb{transform:translateX(110%);transition:transform .28s cubic-bezier(.4,0,.2,1)}
  .sb.mob-open{transform:translateX(0);box-shadow:-6px 0 28px rgba(0,0,0,.35)}
  .main{margin-right:0}
  .ham-btn{display:flex!important}
  .p-layout,.scan-grid{grid-template-columns:1fr}
  .sc-card.full{grid-column:span 1}
  .frow{grid-template-columns:1fr}
  .topbar{padding:0 1.2rem}
}

@media(max-width:580px){
  /* inputs */
  .field{font-size:16px!important}
  /* buttons */
  .save-btn{width:100%;justify-content:center;min-height:48px}
  /* content */
  .content{padding:1.2rem 1rem}
  /* welcome banner */
  .welcome-bar{padding:1.5rem;border-radius:14px}
  .welcome-title{font-size:1.2rem}
  .welcome-sub{font-size:.78rem}
  /* quick cards */
  .qcards{grid-template-columns:repeat(2,1fr);gap:.8rem}
  .qc{padding:1.1rem}
  .qc-ico{width:40px;height:40px;font-size:1rem;margin-bottom:.7rem}
  .qc h4{font-size:.8rem}
  .qc p{font-size:.7rem}
  /* activity list */
  .act-item{padding:.8rem 1rem;gap:.7rem}
  .act-ico{width:34px;height:34px;font-size:.85rem}
  /* wallet */
  .flip-scene{height:185px}
  .flip-card{width:min(340px,92vw);height:min(200px,54vw)}
  .w-tabs{gap:.3rem}
  .wtab{font-size:.68rem;padding:.4rem .3rem}
  .wtab i{font-size:.9rem}
  .w-actions{flex-direction:column;gap:.6rem}
  .w-save-btn{width:100%;justify-content:center}
  /* scan */
  .scan-zone{padding:1.5rem 1rem}
  .sc-mtabs{flex-wrap:wrap;gap:.4rem}
  .sm{font-size:.72rem}
  /* profile */
  .p-av-wrap{margin-bottom:.8rem}
  .p-stats{grid-template-columns:1fr 1fr}
  .topbar{height:52px}
  .topbar-title{font-size:1rem}
  .notif-btn{width:34px;height:34px}
}
</style>
</head>
<body>
<!-- SIDEBAR -->
<nav class="sb">
  <div class="sb-brand">
    <img src="https://upload.wikimedia.org/wikipedia/commons/7/77/Flag_of_Algeria.svg" class="sb-flag" alt="">
    <span class="sb-logo">ORDO</span>
  </div>
  <div class="sb-user">
    <div class="sb-av-wrap" onclick="openAvModal()">
      <div class="sb-av" id="sb-av">Ù…</div>
      <img class="sb-av-img" id="sb-av-img" src="" alt="">
      <div class="sb-av-edit"><i class="fas fa-pen" style="font-size:.5rem;color:#000"></i></div>
    </div>
    <div class="sb-name" id="sb-name">Ù…Ø³ØªØ®Ø¯Ù…</div>
    <div class="sb-type" id="sb-type">Ù…ÙˆØ§Ø·Ù†</div>
    <div class="sb-nin" id="sb-nin">NIN: Â·Â·Â·</div>
  </div>
  <div class="sb-nav">
    <div class="ngl">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <a class="ni act" onclick="showPage('home',this)"><i class="fas fa-house"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a class="ni" onclick="showPage('profile',this)"><i class="fas fa-user-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</a>
    <a class="ni" onclick="showPage('scan',this)"><i class="fas fa-id-card-alt"></i> ÙˆØ«Ø§Ø¦Ù‚ÙŠ</a>
    <div class="ngl">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
    <a class="ni" href="appointments.html"><i class="fas fa-calendar-check"></i> Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</a>
    <a class="ni" href="appointments.html"><i class="fas fa-clock-rotate-left"></i> Ù…ÙˆØ§Ø¹ÙŠØ¯ÙŠ</a>
    <a class="ni" href="#"><i class="fas fa-bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
  </div>
  <div class="sb-bot">
    <button class="logout-btn" onclick="logout()"><i class="fas fa-arrow-right-from-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</nav>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <span class="topbar-title" id="topbar-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    <div><div class="notif-btn"><i class="fas fa-bell"></i><div class="notif-dot"></div></div></div>
  </div>
  <div class="content">

    <!-- HOME -->
    <div class="page act" id="page-home">
      <div class="welcome-bar">
        <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="welcome-name">Ù…Ø³ØªØ®Ø¯Ù…</span> ğŸ‘‹</div>
        <div class="welcome-sub" id="welcome-sub">Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
      </div>
      <div class="qcards">
        <div class="qc" onclick="showPage('scan',null)"><div class="qc-ico"><i class="fas fa-id-card-alt"></i></div><h4>ÙˆØ«Ø§Ø¦Ù‚ÙŠ</h4><p>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ø§Ù„Ø´ÙØ§Ø¡ØŒ Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</p></div>
        <div class="qc" onclick="location.href='appointments.html'"><div class="qc-ico"><i class="fas fa-calendar-plus"></i></div><h4>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</h4><p>Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ ÙÙŠ Ø£ÙŠ Ù…ØµÙ„Ø­Ø©</p></div>
        <div class="qc" onclick="showPage('profile',null)"><div class="qc-ico"><i class="fas fa-pen-to-square"></i></div><h4>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ</h4><p>Ø­Ø¯Ù‘Ø« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</p></div>
        <div class="qc" onclick="location.href='appointments.html'"><div class="qc-ico"><i class="fas fa-clock-rotate-left"></i></div><h4>Ù…ÙˆØ§Ø¹ÙŠØ¯ÙŠ</h4><p>ØªØ§Ø¨Ø¹ Ø­Ø¬ÙˆØ²Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p></div>
      </div>

      <!-- WALLET -->
      <span class="sec-lbl">Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚</span>
      <div class="w-container">
        <div class="w-tabs">
          <div class="wtab act" id="wtab-nin" onclick="selectTab('nin')"><i class="fas fa-id-card"></i><span>Ù‡ÙˆÙŠØ©</span><div class="tsdot" id="tsd-nin"></div></div>
          <div class="wtab" id="wtab-chifa" onclick="selectTab('chifa')"><i class="fas fa-notes-medical"></i><span>Ø´ÙØ§Ø¡</span><div class="tsdot" id="tsd-chifa"></div></div>
          <div class="wtab" id="wtab-permis" onclick="selectTab('permis')"><i class="fas fa-car"></i><span>Ø±Ø®ØµØ©</span><div class="tsdot" id="tsd-permis"></div></div>
        </div>
        <div class="flip-scene">
          <div class="flip-card" id="wcard">
            <!-- FRONT -->
            <div class="flip-face flip-face-front">
              <div class="card-face bg-nin" id="wfg">
                <div class="face-img" id="wf-cover"><img id="wf-img" src="" alt=""></div>
                <div class="face-upload" id="wf-upload" onclick="event.stopPropagation();trigUpload('front')">
                  <i class="fas fa-camera-retro u-ico"></i>
                  <span class="u-txt">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ</span>
                  <input type="file" id="wf-file" accept="image/*" style="display:none" onchange="walletChosen(this,'front')">
                </div>
               <button class="card-del-btn" id="wf-del" onclick="event.stopPropagation();delWalletImg('front')" title="Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©"><i class="fas fa-times"></i></button>
              <!--  <div class="card-deco">
                  <div class="deco-top"><span class="deco-lbl" id="wf-lbl">Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©</span><div class="card-chip"></div></div>
                  <div class="deco-bot"><span class="card-num" id="wf-num">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢</span><div class="card-bw"><span class="card-badge" id="wf-badge">CARTE NATIONALE D'IDENTITE Â· DZ</span><span class="card-flag" id="wf-flag">ğŸ‡©ğŸ‡¿</span></div></div>
                </div>-->
              </div>
            </div>
            <!-- BACK -->
            <div class="flip-face flip-face-back">
              <div class="card-face bg-nin-b" id="wbg">
                <div class="face-img" id="wb-cover"><img id="wb-img" src="" alt=""></div>
                <div class="face-upload" id="wb-upload" onclick="event.stopPropagation();trigUpload('back')">
                  <i class="fas fa-camera-retro u-ico"></i>
                  <span class="u-txt">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ</span>
                  <input type="file" id="wb-file" accept="image/*" style="display:none" onchange="walletChosen(this,'back')">
                </div>
                <button class="card-del-btn" id="wb-del" onclick="event.stopPropagation();delWalletImg('back')" title="Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©"><i class="fas fa-times"></i></button>
               <!--  <div class="card-deco">
                  <div class="back-stripe"></div>
                  <div class="back-sig"></div>
                  <div class="back-bot"><span class="back-lbl" id="wb-lbl">REPUBLIQUE ALGERIENNE</span><span id="wb-flag">ğŸ‡©ğŸ‡¿</span></div>
                </div>-->
              </div>
            </div>
          </div>
        </div>
        <div class="flip-hint">
          <div class="flip-arrows">
            <button class="farr" onclick="goFront()" title="Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ"><i class="fas fa-chevron-right"></i></button>
            <button class="farr" onclick="goBack()" title="Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ"><i class="fas fa-chevron-left"></i></button>
          </div>
          <span class="flip-hint-txt">Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ù‚Ù„Ø¨</span>
        </div>
        <div class="side-dots">
          <div class="sdot act" id="sd-front" onclick="goFront()"></div>
          <div class="sdot" id="sd-back" onclick="goBack()"></div>
        </div>
        <div class="w-actions">
          <button class="w-save-btn" onclick="saveWallet()"><i class="fas fa-download"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
      </div>

      <span class="sec-lbl">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
      <div class="act-list" id="act-list"></div>
    </div>

    <!-- PROFILE -->
    <div class="page" id="page-profile">
      <div class="p-layout">
        <div class="p-card">
          <div class="p-av-wrap">
            <div class="p-av" id="p-av">Ù…</div>
            <img class="p-av-img" id="p-av-img" src="" alt="">
            <div class="av-edit" onclick="openAvModal()"><i class="fas fa-pen"></i></div>
          </div>
          <div class="p-name" id="p-name">Ù…Ø³ØªØ®Ø¯Ù…</div>
          <div class="p-type" id="p-type">Ù…ÙˆØ§Ø·Ù†</div>
          <div class="p-nin" id="p-nin">NIN: Â·Â·Â·</div>
          <div class="p-stats">
            <div class="pst"><strong id="ps-appts">0</strong><span>Ù…ÙˆØ§Ø¹ÙŠØ¯</span></div>
            <div class="pst"><strong id="ps-docs">0</strong><span>ÙˆØ«Ø§Ø¦Ù‚</span></div>
          </div>
        </div>
        <div class="e-card">
          <h3><i class="fas fa-pen-to-square" style="color:var(--g);margin-left:.5rem;font-size:.95rem"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
          <div class="fsect"><i class="fas fa-user"></i> Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
          <div class="frow">
            <div class="fg"><label>Ø§Ù„Ø§Ø³Ù…</label><input class="field" id="e-fname" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"></div>
            <div class="fg"><label>Ø§Ù„Ù„Ù‚Ø¨</label><input class="field" id="e-lname" type="text" placeholder="Ù„Ù‚Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"></div>
          </div>
          <div class="frow">
            <div class="fg"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input class="field" id="e-dob" type="date"></div>
            <div class="fg"><label>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input class="field" id="e-pob" type="text" placeholder="Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"></div>
          </div>
          <hr class="hr">
          <div class="fsect"><i class="fas fa-people-group"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†</div>
          <div class="frow">
            <div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ø£Ø¨</label><input class="field" id="e-ffname" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¨"></div>
            <div class="fg"><label>Ù„Ù‚Ø¨ Ø§Ù„Ø£Ø¨ <small style="font-weight:400;color:var(--muted)">(= Ù„Ù‚Ø¨ Ø§Ù„Ø§Ø¨Ù†)</small></label><input class="field" id="e-flname" type="text" disabled style="background:var(--off)"></div>
          </div>
          <div class="frow">
            <div class="fg"><label>Ø§Ø³Ù… Ø§Ù„Ø£Ù…</label><input class="field" id="e-mfname" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ù…"></div>
            <div class="fg"><label>Ù„Ù‚Ø¨ Ø§Ù„Ø£Ù…</label><input class="field" id="e-mlname" type="text" placeholder="Ù„Ù‚Ø¨ Ø§Ù„Ø£Ù… (Ù‚Ø¨Ù„ Ø§Ù„Ø²ÙˆØ§Ø¬)"></div>
          </div>
          <hr class="hr">
          <div class="fsect"><i class="fas fa-language"></i> Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© â€” Informations en FranÃ§ais</div>
          <div class="frow">
            <div class="fg"><label>Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© â€” PrÃ©nom</label><input class="field" id="e-fn-fr" type="text" placeholder="PrÃ©nom en franÃ§ais" style="direction:ltr;text-align:left"></div>
            <div class="fg"><label>Ø§Ù„Ù„Ù‚Ø¨ Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© â€” Nom</label><input class="field" id="e-ln-fr" type="text" placeholder="Nom en franÃ§ais" style="direction:ltr;text-align:left"></div>
          </div>
          <div class="frow">
            <div class="fg"><label>Ø±Ù‚Ù… Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input class="field" id="e-bcn" type="text" placeholder="Ù…Ø«Ø§Ù„: 1234/2000"></div>
            <div class="fg"><label>Ø§Ù„Ø¬Ù†Ø³</label><select class="field" id="e-gender"><option value="">Ø§Ø®ØªØ±...</option><option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option><option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option></select></div>
          </div>
          <hr class="hr">
          <div class="fsect"><i class="fas fa-envelope"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>
          <div class="frow">
            <div class="fg"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input class="field" id="e-email" type="email" placeholder="example@email.com"></div>
            <div class="fg"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input class="field" id="e-phone" type="tel" placeholder="05 XX XX XX XX"></div>
          </div>
          <div class="fg"><label>Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠ (NIN)</label><input class="field" id="e-nin" type="text" disabled></div>
          <div class="fg"><label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label><input class="field" id="e-type" type="text" disabled></div>
          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
            <button class="save-btn" onclick="saveProfile()"><i class="fas fa-check"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <div class="saved-msg" id="saved-msg"><i class="fas fa-circle-check"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­</div>
          </div>
          <div style="margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--b)">
            <h3 style="font-size:1rem;margin-bottom:1.2rem"><i class="fas fa-lock" style="color:var(--g);margin-left:.5rem"></i>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
            <div class="frow">
              <div class="fg"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label><input class="field" id="e-pw" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
              <div class="fg"><label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input class="field" id="e-pw2" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
            </div>
            <button class="save-btn" onclick="savePw()" style="background:var(--gd)"><i class="fas fa-shield-halved"></i> ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SCAN -->
    <div class="page" id="page-scan">
      <div style="margin-bottom:1.5rem">
        <span class="sec-lbl">ÙˆØ«Ø§Ø¦Ù‚ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠØ©</span>
        <p style="font-size:.82rem;color:var(--muted)">Ø§Ø±ÙØ¹ ØµÙˆØ± ÙˆØ«Ø§Ø¦Ù‚Ùƒ Â· ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØªØ¨Ù‚Ù‰ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>
      </div>
      <div class="scan-grid">

        <!-- NIN -->
        <div class="sc-card" id="sc-nin">
          <div class="doc-badge" id="badge-nin"><i class="fas fa-circle-check"></i> Ù…Ø­ÙÙˆØ¸Ø©</div>
          <div class="sc-hdr"><div class="sc-ico n"><i class="fas fa-id-card"></i></div><div><div class="sc-title">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠØ©</div><div class="sc-sub">Carte Nationale d'IdentitÃ©</div></div></div>
          <div class="sc-mtabs">
            <button class="sm act" onclick="switchScan('nin','up',this)"><i class="fas fa-upload"></i> Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
            <button class="sm" onclick="switchScan('nin','cam',this)"><i class="fas fa-camera"></i> ÙƒØ§Ù…ÙŠØ±Ø§</button>
          </div>
          <div class="sv act" id="sv-nin-up">
            <p style="font-size:.78rem;color:var(--muted);margin-bottom:.8rem;font-weight:600">Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ</p>
            <div class="scan-zone" onclick="g('sf-nin-front').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)" ondrop="dDrop(event,'nin','front')">
              <i class="fas fa-cloud-arrow-up"></i><p>Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©</p><small>PNG, JPG â€” Ø­ØªÙ‰ 8MB</small>
            </div>
            <input type="file" id="sf-nin-front" accept="image/*" style="display:none" onchange="scanFile(this,'nin','front')">
            <div class="scan-prev" id="sp-nin-front"><img id="si-nin-front" src="" alt=""><button class="scan-prev-del" onclick="clearScan('nin','front')"><i class="fas fa-times"></i></button></div>
            <p style="font-size:.78rem;color:var(--muted);margin:1rem 0 .8rem;font-weight:600">Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ</p>
            <div class="scan-zone" onclick="g('sf-nin-back').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)" ondrop="dDrop(event,'nin','back')">
              <i class="fas fa-rotate-right"></i><p>Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©</p><small>PNG, JPG â€” Ø­ØªÙ‰ 8MB</small>
            </div>
            <input type="file" id="sf-nin-back" accept="image/*" style="display:none" onchange="scanFile(this,'nin','back')">
            <div class="scan-prev" id="sp-nin-back"><img id="si-nin-back" src="" alt=""><button class="scan-prev-del" onclick="clearScan('nin','back')"><i class="fas fa-times"></i></button></div>
            <div class="doc-st" id="dst-nin"></div>
            <div style="margin-top:1.2rem">
              <div class="df"><label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label><input type="text" id="dm-nin-num" placeholder="Ù…Ø«Ø§Ù„: 123456789"></div>
              <div class="df"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="dm-nin-exp"></div>
              <button class="doc-save-btn" onclick="saveDocMeta('nin')"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
              <button class="doc-del-btn" id="ddel-nin" onclick="deleteDoc('nin')" style="display:none"><i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</button>
            </div>
          </div>
          <div class="sv" id="sv-nin-cam">
            <div class="ph-scan"><div class="ph-qr"><i class="fas fa-qrcode"></i></div><p>Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©</p><button class="cam-btn" onclick="openCam('nin')"><i class="fas fa-camera"></i> ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button></div>
            <video id="cam-nin" style="display:none;width:100%;border-radius:10px;margin-top:1rem" autoplay playsinline></video>
            <canvas id="cv-nin" style="display:none"></canvas>
            <div id="ca-nin" style="display:none;margin-top:.8rem;gap:.8rem">
              <button class="cam-btn" onclick="capPhoto('nin')"><i class="fas fa-circle"></i> Ø§Ù„ØªÙ‚Ø§Ø·</button>
              <button class="cam-btn" onclick="stopCam('nin')" style="background:var(--red)"><i class="fas fa-stop"></i> Ø¥ÙŠÙ‚Ø§Ù</button>
            </div>
          </div>
        </div>

        <!-- CHIFA -->
        <div class="sc-card" id="sc-chifa">
          <div class="doc-badge" id="badge-chifa"><i class="fas fa-circle-check"></i> Ù…Ø­ÙÙˆØ¸Ø©</div>
          <div class="sc-hdr"><div class="sc-ico c"><i class="fas fa-notes-medical"></i></div><div><div class="sc-title">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´ÙØ§Ø¡</div><div class="sc-sub">Carte Chifa Â· CNAS</div></div></div>
          <div class="sc-mtabs">
            <button class="sm act" onclick="switchScan('chifa','up',this)"><i class="fas fa-upload"></i> Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
            <button class="sm" onclick="switchScan('chifa','cam',this)"><i class="fas fa-camera"></i> ÙƒØ§Ù…ÙŠØ±Ø§</button>
          </div>
          <div class="sv act" id="sv-chifa-up">
            <div class="scan-zone" onclick="g('sf-chifa').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)" ondrop="dDropS(event,'chifa')">
              <i class="fas fa-cloud-arrow-up"></i><p>Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p><small>PNG, JPG â€” Ø­ØªÙ‰ 8MB</small>
            </div>
            <input type="file" id="sf-chifa" accept="image/*" style="display:none" onchange="scanFileS(this,'chifa')">
            <div class="scan-prev" id="sp-chifa"><img id="si-chifa" src="" alt=""><button class="scan-prev-del" onclick="clearScanS('chifa')"><i class="fas fa-times"></i></button></div>
            <div class="doc-st" id="dst-chifa"></div>
            <div style="margin-top:1.2rem">
              <div class="df"><label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label><input type="text" id="dm-chifa-num" placeholder="Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´ÙØ§Ø¡"></div>
              <div class="df"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="dm-chifa-exp"></div>
              <button class="doc-save-btn" style="background:var(--accent);color:#000" onclick="saveDocMeta('chifa')"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
              <button class="doc-del-btn" id="ddel-chifa" onclick="deleteDoc('chifa')" style="display:none"><i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</button>
            </div>
          </div>
          <div class="sv" id="sv-chifa-cam">
            <div class="ph-scan"><div class="ph-qr"><i class="fas fa-qrcode"></i></div><p>Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</p><button class="cam-btn" style="background:var(--accent);color:#000" onclick="openCam('chifa')"><i class="fas fa-camera"></i> ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button></div>
            <video id="cam-chifa" style="display:none;width:100%;border-radius:10px;margin-top:1rem" autoplay playsinline></video>
            <canvas id="cv-chifa" style="display:none"></canvas>
          </div>
        </div>

        <!-- PERMIS -->
        <div class="sc-card" id="sc-permis">
          <div class="doc-badge" id="badge-permis"><i class="fas fa-circle-check"></i> Ù…Ø­ÙÙˆØ¸Ø©</div>
          <div class="sc-hdr"><div class="sc-ico p"><i class="fas fa-car"></i></div><div><div class="sc-title">Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</div><div class="sc-sub">Permis de Conduire Â· DZ</div></div></div>
          <div class="sc-mtabs">
            <button class="sm act" onclick="switchScan('permis','up',this)"><i class="fas fa-upload"></i> Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
            <button class="sm" onclick="switchScan('permis','cam',this)"><i class="fas fa-camera"></i> ÙƒØ§Ù…ÙŠØ±Ø§</button>
          </div>
          <div class="sv act" id="sv-permis-up">
            <p style="font-size:.78rem;color:var(--muted);margin-bottom:.8rem;font-weight:600">Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ</p>
            <div class="scan-zone" onclick="g('sf-permis-front').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)" ondrop="dDrop(event,'permis','front')">
              <i class="fas fa-cloud-arrow-up"></i><p>Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„Ù„Ø±Ø®ØµØ©</p><small>PNG, JPG â€” Ø­ØªÙ‰ 8MB</small>
            </div>
            <input type="file" id="sf-permis-front" accept="image/*" style="display:none" onchange="scanFile(this,'permis','front')">
            <div class="scan-prev" id="sp-permis-front"><img id="si-permis-front" src="" alt=""><button class="scan-prev-del" onclick="clearScan('permis','front')"><i class="fas fa-times"></i></button></div>
            <p style="font-size:.78rem;color:var(--muted);margin:1rem 0 .8rem;font-weight:600">Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ</p>
            <div class="scan-zone" onclick="g('sf-permis-back').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)" ondrop="dDrop(event,'permis','back')">
              <i class="fas fa-rotate-right"></i><p>Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø±Ø®ØµØ©</p><small>PNG, JPG â€” Ø­ØªÙ‰ 8MB</small>
            </div>
            <input type="file" id="sf-permis-back" accept="image/*" style="display:none" onchange="scanFile(this,'permis','back')">
            <div class="scan-prev" id="sp-permis-back"><img id="si-permis-back" src="" alt=""><button class="scan-prev-del" onclick="clearScan('permis','back')"><i class="fas fa-times"></i></button></div>
            <div class="doc-st" id="dst-permis"></div>
            <div style="margin-top:1.2rem">
              <div class="df"><label>Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©</label><input type="text" id="dm-permis-num" placeholder="Ù…Ø«Ø§Ù„: 12-DZ-456789"></div>
              <div class="df"><label>ØµÙ†Ù Ø§Ù„Ø±Ø®ØµØ©</label><select id="dm-permis-cat"><option value="">Ø§Ø®ØªØ±...</option><option value="A">A â€” Ø¯Ø±Ø§Ø¬Ø§Øª Ù†Ø§Ø±ÙŠØ©</option><option value="B">B â€” Ø³ÙŠØ§Ø±Ø§Øª Ø®ÙÙŠÙØ©</option><option value="C">C â€” Ø´Ø§Ø­Ù†Ø§Øª</option><option value="D">D â€” Ø­Ø§ÙÙ„Ø§Øª</option><option value="EB">B+E â€” Ù…Ù‚Ø·ÙˆØ±Ø©</option></select></div>
              <div class="df"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="dm-permis-exp"></div>
              <button class="doc-save-btn" style="background:var(--blue)" onclick="saveDocMeta('permis')"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø±Ø®ØµØ©</button>
              <button class="doc-del-btn" id="ddel-permis" onclick="deleteDoc('permis')" style="display:none"><i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</button>
            </div>
          </div>
          <div class="sv" id="sv-permis-cam">
            <div class="ph-scan"><div class="ph-qr"><i class="fas fa-qrcode"></i></div><p>Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</p><button class="cam-btn" style="background:var(--blue)" onclick="openCam('permis')"><i class="fas fa-camera"></i> ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button></div>
            <video id="cam-permis" style="display:none;width:100%;border-radius:10px;margin-top:1rem" autoplay playsinline></video>
            <canvas id="cv-permis" style="display:none"></canvas>
          </div>
        </div>

        <!-- OTHER -->
        <div class="sc-card full">
          <div class="sc-hdr"><div class="sc-ico o"><i class="fas fa-folder-open"></i></div><div><div class="sc-title">ÙˆØ«Ø§Ø¦Ù‚ Ø£Ø®Ø±Ù‰</div><div class="sc-sub">Ø§Ø±ÙØ¹ ÙˆØ«Ø§Ø¦Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø© Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</div></div></div>
          <div class="scan-zone" onclick="g('sf-other').click()" ondragover="dOver(event,this)" ondragleave="dLeave(this)">
            <i class="fas fa-folder-open"></i><p>Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø£Ùˆ Ø§Ø¶ØºØ· Ù‡Ù†Ø§</p><small>PNG, JPG, PDF â€” Ø´Ù‡Ø§Ø¯Ø© Ù…ÙŠÙ„Ø§Ø¯ØŒ ÙƒØªÙŠØ¨ Ø¹Ø§Ø¦Ù„ÙŠØŒ ÙˆØ«Ø§Ø¦Ù‚ Ø£Ø®Ø±Ù‰</small>
          </div>
          <input type="file" id="sf-other" accept="image/*,.pdf" multiple style="display:none" onchange="multiFiles(this)">
          <div id="other-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:1rem;margin-top:1rem"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- AVATAR MODAL -->
<div class="av-modal" id="av-modal">
  <div class="av-modal-box">
    <div class="av-modal-title"><i class="fas fa-user-circle" style="color:var(--g)"></i> ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
    <div class="av-prev-wrap" onclick="g('av-file').click()">
      <img id="av-prev-img" src="" alt="">
      <i class="fas fa-user av-placeholder" id="av-ph"></i>
    </div>
    <div class="av-drop" onclick="g('av-file').click()">
      <i class="fas fa-cloud-arrow-up"></i><p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§</p>
      <small style="color:rgba(90,112,102,.6);font-size:.72rem">PNG, JPG â€” Ø­ØªÙ‰ 5MB</small>
    </div>
    <input type="file" id="av-file" accept="image/*" style="display:none" onchange="previewAv(this)">
    <div class="av-acts">
      <button class="av-cancel" onclick="closeAvModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="av-save" id="av-save-btn" onclick="saveAv()" disabled style="opacity:.5">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"><i class="fas fa-circle-check" id="t-ico"></i><span id="t-msg"></span></div>
<script>
// ============================================================
// IDB
// ============================================================
var DB=null;
function openDB(cb){
  if(DB){cb(DB);return;}
  var r=indexedDB.open('ordo_v3',1);
  r.onupgradeneeded=function(e){e.target.result.createObjectStore('imgs');};
  r.onsuccess=function(e){DB=e.target.result;cb(DB);};
  r.onerror=function(){cb(null);};
}
function dbPut(k,v,cb){openDB(function(db){if(!db){if(cb)cb(false);return;}var tx=db.transaction('imgs','readwrite');tx.objectStore('imgs').put(v,k).onsuccess=function(){if(cb)cb(true);};tx.onerror=function(){if(cb)cb(false);};});}
function dbGet(k,cb){openDB(function(db){if(!db){cb(null);return;}var tx=db.transaction('imgs','readonly');var r=tx.objectStore('imgs').get(k);r.onsuccess=function(){cb(r.result||null);};r.onerror=function(){cb(null);};});}
function dbDel(k,cb){openDB(function(db){if(!db){if(cb)cb();return;}var tx=db.transaction('imgs','readwrite');tx.objectStore('imgs').delete(k);tx.oncomplete=function(){if(cb)cb();};});}
function ik(nin,doc,side){return nin+'|'+doc+'|'+side;}

// ============================================================
// STATE
// ============================================================
var CU=null;          // current user
var TAB='nin';        // active wallet tab
var FLIPPED=false;    // card flipped?
var CACHE={nin:{},chifa:{},permis:{}};  // img cache

var WCFG={
  nin:{fg:'bg-nin',bg:'bg-nin-b',lbl:'Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©',badge:"CARTE NATIONALE D'IDENTITE Â· DZ",flag:'ğŸ‡©ğŸ‡¿',blbl:'REPUBLIQUE ALGERIENNE Â· DZ',bflag:'ğŸ‡©ğŸ‡¿',hasBack:true},
  chifa:{fg:'bg-chifa',bg:'bg-chifa-b',lbl:'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ·Ù†ÙŠ Ù„Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',badge:'CARTE CHIFA Â· CNAS',flag:'ğŸ¥',blbl:'CNAS Â· ALGERIE',bflag:'ğŸ¥',hasBack:false},
  permis:{fg:'bg-permis',bg:'bg-permis-b',lbl:'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø¬Ù…Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',badge:'PERMIS DE CONDUIRE Â· DZ',flag:'ğŸš—',blbl:'REPUBLIQUE ALGERIENNE Â· DZ',bflag:'ğŸ‡©ğŸ‡¿',hasBack:true}
};

// ============================================================
// INIT
// ============================================================
(function(){
  var raw=localStorage.getItem('ordo_current');
  if(!raw){location.href='auth.html';return;}
  CU=JSON.parse(raw);
  if(CU.role==='facility'){location.href='facility.html';return;}

  var ini=(CU.fname||'Ù…')[0];
  s('sb-av',ini); s('sb-name',(CU.fname||'')+' '+(CU.lname||''));
  s('sb-type',CU.type||'Ù…ÙˆØ§Ø·Ù†'); s('sb-nin','NIN: '+(CU.nin||'').substring(0,8)+'Â·Â·Â·');
  s('welcome-name',CU.fname||'Ù…Ø³ØªØ®Ø¯Ù…');

  var now=new Date();
  var dn=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
  var mn=['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠ','Ø¬ÙˆØ§Ù†','Ø¬ÙˆÙŠÙ„ÙŠØ©','Ø£ÙˆØª','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  s('welcome-sub',dn[now.getDay()]+' '+now.getDate()+' '+mn[now.getMonth()]+' '+now.getFullYear());

  s('p-av',ini); s('p-name',(CU.fname||'')+' '+(CU.lname||''));
  s('p-type',CU.type||'Ù…ÙˆØ§Ø·Ù†'); s('p-nin','NIN: '+(CU.nin||''));
  sv('e-fname',CU.fname||''); sv('e-lname',CU.lname||'');
  sv('e-email',CU.email||''); sv('e-phone',CU.phone||'');
  sv('e-dob',CU.dob||''); sv('e-gender',CU.gender||'');
  sv('e-pob',CU.pob||''); sv('e-job',CU.job||'');
  sv('e-ffname',CU.fatherFname||''); sv('e-flname',CU.fatherLname||CU.lname||'');
  sv('e-mfname',CU.motherFname||''); sv('e-mlname',CU.motherLname||'');
  sv('e-fn-fr',CU.fnFr||''); sv('e-ln-fr',CU.lnFr||'');
  sv('e-bcn',CU.birthCertNum||'');
  sv('e-nin',CU.nin||''); sv('e-type',CU.type||'');

  // Load metadata
  var docs=JSON.parse(localStorage.getItem('ordo_docs_'+(CU.nin||''))||'{}');
  s('ps-docs',Object.keys(docs).length); s('ps-appts','3');
  ['nin','chifa','permis'].forEach(function(k){
    if(!docs[k])return;
    g('badge-'+k).classList.add('show');
    g('ddel-'+k).style.display='flex';
    g('wtab-'+k).classList.add('has-doc');
    sv('dm-'+k+'-num',docs[k].num||'');
    sv('dm-'+k+'-exp',docs[k].exp||'');
    if(k==='permis') sv('dm-permis-cat',docs[k].cat||'');
    var st=g('dst-'+k);
    if(st){st.textContent='âœ“ Ù…Ø­ÙÙˆØ¸Ø© Ø¨ØªØ§Ø±ÙŠØ® '+(docs[k].savedAt||'');st.className='doc-st ok';st.style.display='block';}
  });

  renderActs();

  // Load images from IDB into cache, then show in scan + wallet
  var nin=CU.nin||'default';
  var toLoad=[
    {doc:'nin',side:'front'},{doc:'nin',side:'back'},
    {doc:'chifa',side:'img'},
    {doc:'permis',side:'front'},{doc:'permis',side:'back'}
  ];
  var done=0;
  toLoad.forEach(function(item){
    dbGet(ik(nin,item.doc,item.side),function(data){
      if(data){
        CACHE[item.doc][item.side]=data;
        // Update scan previews
        var suf=item.side==='img'?'':'-'+item.side;
        var si=g('si-'+item.doc+suf), sp=g('sp-'+item.doc+suf);
        if(si)si.src=data; if(sp)sp.style.display='block';
      }
      done++;
      if(done===toLoad.length) applyTab('nin',false);
    });
  });

  // Avatar
  dbGet(nin+'_avatar',function(d){if(d)applyAv(d);});
  initDrag();
})();

// ============================================================
// HELPERS
// ============================================================
function g(id){return document.getElementById(id);}
function s(id,v){var e=g(id);if(e)e.textContent=v;}
function sv(id,v){var e=g(id);if(e)e.value=v;}
function toast(msg,type){
  var t=g('toast'); s('t-msg',msg);
  var ico=g('t-ico');
  t.style.background=type==='err'?'var(--red)':'var(--g)';
  if(ico)ico.className=type==='err'?'fas fa-circle-xmark':'fas fa-circle-check';
  t.classList.add('show'); clearTimeout(t._t);
  t._t=setTimeout(function(){t.classList.remove('show');},3200);
}

// ============================================================
// NAV
// ============================================================
function showPage(name,el){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('act');});
  g('page-'+name).classList.add('act');
  document.querySelectorAll('.ni').forEach(function(n){n.classList.remove('act');});
  if(el)el.classList.add('act');
  var titles={home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',profile:'Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©',scan:'ÙˆØ«Ø§Ø¦Ù‚ÙŠ'};
  s('topbar-title',titles[name]||'');
}
function logout(){localStorage.removeItem('ordo_current');location.href='auth.html';}

// ============================================================
// ACTIVITIES
// ============================================================
var ACTS=[
  {ico:'fas fa-id-card',bg:'rgba(27,94,66,.08)',c:'var(--g)',t:'Ø­Ø¬Ø² ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ',sub:'Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„ÙˆØ³Ø·Ù‰',s:'sp',sl:'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'},
  {ico:'fas fa-passport',bg:'rgba(200,168,75,.1)',c:'var(--accent)',t:'Ø·Ù„Ø¨ Ø¬ÙˆØ§Ø² Ø³ÙØ±',sub:'Ø¨Ù„Ø¯ÙŠØ© Ø­ÙŠØ¯Ø±Ø©',s:'sd',sl:'Ù…Ù†Ø¬Ø²'},
  {ico:'fas fa-car',bg:'rgba(21,101,192,.08)',c:'var(--blue)',t:'ØªØ¬Ø¯ÙŠØ¯ Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø©',sub:'Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ù†Ù‚Ù„',s:'sp',sl:'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'},
  {ico:'fas fa-hospital',bg:'rgba(198,40,40,.07)',c:'var(--red)',t:'Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠ â€” Ø¹ÙŠØ§Ø¯Ø© Ø¨Ù† Ø¹ÙƒÙ†ÙˆÙ†',sub:'',s:'sc',sl:'Ù…Ù„ØºÙ‰'},
  {ico:'fas fa-notes-medical',bg:'rgba(200,168,75,.1)',c:'var(--accent)',t:'ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´ÙØ§Ø¡',sub:'CNAS',s:'sd',sl:'Ù…Ù†Ø¬Ø²'},
];
function renderActs(){
  var list=g('act-list'); if(!list)return;
  var now=new Date();
  var mn=['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠ','Ø¬ÙˆØ§Ù†','Ø¬ÙˆÙŠÙ„ÙŠØ©','Ø£ÙˆØª','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  list.innerHTML=ACTS.slice(0,6).map(function(a,i){
    var d=new Date(now); d.setDate(d.getDate()-(i*7+i));
    return '<div class="act-item"><div class="act-ico" style="background:'+a.bg+';color:'+a.c+'"><i class="'+a.ico+'"></i></div><div class="act-txt"><strong>'+a.t+'</strong><span>'+(a.sub?a.sub+' Â· ':'')+d.getDate()+' '+mn[d.getMonth()]+' '+d.getFullYear()+'</span></div><span class="act-st '+a.s+'">'+a.sl+'</span></div>';
  }).join('');
}

// ============================================================
// PROFILE
// ============================================================
function saveProfile(){
  CU.fname=g('e-fname').value; CU.lname=g('e-lname').value;
  CU.email=g('e-email').value; CU.phone=g('e-phone').value;
  CU.dob=g('e-dob').value;     CU.gender=g('e-gender').value;
  CU.pob=g('e-pob').value;     CU.job=g('e-job')?g('e-job').value:'';
  CU.fatherFname=g('e-ffname').value; CU.fatherLname=CU.lname;
  CU.motherFname=g('e-mfname').value; CU.motherLname=g('e-mlname').value;
  CU.fnFr=g('e-fn-fr').value;  CU.lnFr=g('e-ln-fr').value;
  CU.birthCertNum=g('e-bcn').value;
  // keep fatherLname in sync with lname
  sv('e-flname',CU.lname);
  var users=JSON.parse(localStorage.getItem('ordo_users')||'[]');
  var idx=users.findIndex(function(u){return u.nin===CU.nin;});
  if(idx>=0)users[idx]=Object.assign(users[idx],CU);
  localStorage.setItem('ordo_users',JSON.stringify(users));
  localStorage.setItem('ordo_current',JSON.stringify(CU));
  s('sb-name',CU.fname+' '+CU.lname); s('p-name',CU.fname+' '+CU.lname); s('welcome-name',CU.fname);
  var sm=g('saved-msg'); sm.style.display='flex'; setTimeout(function(){sm.style.display='none';},3000);
  toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
  ACTS.unshift({ico:'fas fa-user-pen',bg:'rgba(27,94,66,.08)',c:'var(--g)',t:'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©',sub:'',s:'sd',sl:'Ù…Ù†Ø¬Ø²'});
  if(ACTS.length>8)ACTS.pop(); renderActs();
}
function savePw(){
  var pw=g('e-pw').value, pw2=g('e-pw2').value;
  if(!pw||pw.length<6){toast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹','err');return;}
  if(pw!==pw2){toast('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†','err');return;}
  var users=JSON.parse(localStorage.getItem('ordo_users')||'[]');
  var idx=users.findIndex(function(u){return u.nin===CU.nin;});
  if(idx>=0)users[idx].pw=pw; CU.pw=pw;
  localStorage.setItem('ordo_users',JSON.stringify(users));
  localStorage.setItem('ordo_current',JSON.stringify(CU));
  g('e-pw').value=''; g('e-pw2').value='';
  toast('ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
}

// ============================================================
// WALLET â€” CORE v2 (ALL BUGS FIXED)
// ============================================================

// setFace: single source of truth â€” show image OR upload zone
function setFace(face, data){
  var isF=face==='front';
  var cover=g(isF?'wf-cover':'wb-cover');
  var img=g(isF?'wf-img':'wb-img');
  var upload=g(isF?'wf-upload':'wb-upload');
  var del=g(isF?'wf-del':'wb-del');
  if(data){
    if(img) img.src=data;
    if(cover){ cover.classList.add('show'); }
    if(upload){ upload.classList.add('hidden'); }
    if(del){ del.style.display='flex'; }
  } else {
    if(cover){ cover.classList.remove('show'); }
    if(img) img.src='';
    if(upload){ upload.classList.remove('hidden'); }
    if(del){ del.style.display='none'; }
  }
}

// loadFace: cache â†’ IDB, with tab guard to prevent stale async updates
function loadFace(face, doc, side, expectedTab){
  if(TAB!==expectedTab) return;
  if(!side){
    var cover=g(face==='front'?'wf-cover':'wb-cover');
    var upload=g(face==='front'?'wf-upload':'wb-upload');
    var del=g(face==='front'?'wf-del':'wb-del');
    if(cover) cover.classList.remove('show');
    if(upload) upload.style.display='none';
    if(del) del.style.display='none';
    return;
  }
  var upload=g(face==='front'?'wf-upload':'wb-upload');
  if(upload) upload.style.display='';
  var cached=CACHE[doc]&&CACHE[doc][side];
  if(cached){ setFace(face,cached); return; }
  var nin=(CU&&CU.nin)?CU.nin:'default';
  dbGet(ik(nin,doc,side),function(d){
    if(TAB!==expectedTab) return;
    if(d){ if(!CACHE[doc])CACHE[doc]={}; CACHE[doc][side]=d; setFace(face,d); }
    else { setFace(face,null); }
  });
}

function applyTab(tab, animate){
  TAB=tab; FLIPPED=false;
  var cfg=WCFG[tab];
  var card=g('wcard');
  if(!animate){ card.style.transition='none'; card.classList.remove('flipped'); setTimeout(function(){card.style.transition='';},30); }
  else { card.classList.remove('flipped'); }
  document.querySelectorAll('.wtab').forEach(function(t){t.classList.remove('act');});
  g('wtab-'+tab).classList.add('act');
  var fgEl=g('wfg'), bgEl=g('wbg');
  ['bg-nin','bg-chifa','bg-permis'].forEach(function(c){fgEl.classList.remove(c);});
  ['bg-nin-b','bg-chifa-b','bg-permis-b'].forEach(function(c){bgEl.classList.remove(c);});
  fgEl.classList.add(cfg.fg); bgEl.classList.add(cfg.bg);
  s('wf-lbl',cfg.lbl); s('wf-badge',cfg.badge); s('wf-flag',cfg.flag);
  s('wb-lbl',cfg.blbl); s('wb-flag',cfg.bflag);
  var docs=JSON.parse(localStorage.getItem('ordo_docs_'+(CU&&CU.nin||''))||'{}');
  s('wf-num',(docs[tab]&&docs[tab].num)?docs[tab].num:'â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢');
  g('sd-front').classList.add('act'); g('sd-back').classList.remove('act');
  loadFace('front',tab,(tab==='chifa'?'img':'front'),tab);
  loadFace('back',tab,cfg.hasBack?'back':null,tab);
}

function selectTab(tab){ applyTab(tab,true); }

function goFront(){
  FLIPPED=false;
  g('wcard').classList.remove('flipped');
  g('sd-front').classList.add('act'); g('sd-back').classList.remove('act');
  loadFace('front',TAB,(TAB==='chifa'?'img':'front'),TAB);
}

function goBack(){
  var cfg=WCFG[TAB];
  if(!cfg.hasBack){ toast('Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ÙŠØ³ Ù„Ù‡Ø§ ÙˆØ¬Ù‡ Ø®Ù„ÙÙŠ','err'); return; }
  FLIPPED=true;
  g('wcard').classList.add('flipped');
  g('sd-front').classList.remove('act'); g('sd-back').classList.add('act');
  loadFace('back',TAB,'back',TAB);
}

// Drag to flip
function initDrag(){
  var card=g('wcard'), sx=0, drag=false;
  card.addEventListener('mousedown',function(e){
    if(e.target.closest('.face-upload')||e.target.closest('input')||e.target.closest('.card-del-btn'))return;
    e.preventDefault(); sx=e.clientX; drag=false;
    document.addEventListener('mousemove',onMM); document.addEventListener('mouseup',onMU);
  });
  function onMM(e){if(Math.abs(e.clientX-sx)>6)drag=true;}
  function onMU(e){
    document.removeEventListener('mousemove',onMM); document.removeEventListener('mouseup',onMU);
    var dx=e.clientX-sx;
    if(!drag){ FLIPPED?goFront():goBack(); } else if(dx>50){goFront();} else if(dx<-50){goBack();}
    drag=false;
  }
  card.addEventListener('touchstart',function(e){
    if(e.target.closest('.face-upload')||e.target.closest('input')||e.target.closest('.card-del-btn'))return;
    sx=e.touches[0].clientX; drag=false;
  },{passive:true});
  card.addEventListener('touchmove',function(e){if(Math.abs(e.touches[0].clientX-sx)>6)drag=true;},{passive:true});
  card.addEventListener('touchend',function(e){
    var dx=e.changedTouches[0].clientX-sx;
    if(!drag){ FLIPPED?goFront():goBack(); } else if(dx>50){goFront();} else if(dx<-50){goBack();}
    drag=false;
  });
}

// ============================================================
// WALLET UPLOAD + DELETE
// ============================================================
function trigUpload(face){ g(face==='front'?'wf-file':'wb-file').click(); }

function walletChosen(input, face){
  var file=input.files[0]; if(!file)return;
  if(file.size>8*1024*1024){toast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± (Ø£Ù‚ØµÙ‰ 8MB)','err');return;}
  var doc=TAB;
  var side=(face==='front')?(doc==='chifa'?'img':'front'):'back';
  var nin=(CU&&CU.nin)?CU.nin:'default';
  var reader=new FileReader();
  reader.onload=function(ev){
    var data=ev.target.result;
    if(!CACHE[doc])CACHE[doc]={};
    CACHE[doc][side]=data;
    dbPut(ik(nin,doc,side),data,function(ok){ toast(ok?'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ“':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ â€” Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù…ØªÙ„Ø¦Ø©ØŸ','err'); });
    setFace(face,data);
    syncScanPreview(doc,side,data);
  };
  reader.readAsDataURL(file);
}

function delWalletImg(face){
  var doc=TAB;
  var side=(face==='front')?(doc==='chifa'?'img':'front'):'back';
  var nin=(CU&&CU.nin)?CU.nin:'default';
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')) return;
  if(CACHE[doc]) delete CACHE[doc][side];
  dbDel(ik(nin,doc,side));
  setFace(face,null);
  if(doc==='chifa'){
    var si=g('si-chifa'),sp=g('sp-chifa'),sf=g('sf-chifa');
    if(si)si.src=''; if(sp)sp.style.display='none'; if(sf)sf.value='';
  } else {
    var si2=g('si-'+doc+'-'+side),sp2=g('sp-'+doc+'-'+side),sf2=g('sf-'+doc+'-'+side);
    if(si2)si2.src=''; if(sp2)sp2.style.display='none'; if(sf2)sf2.value='';
  }
  toast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©');
}

function saveWallet(){
  var tab=TAB, nin=CU.nin;
  var num=(g('dm-'+tab+'-num')||{value:''}).value;
  var exp=(g('dm-'+tab+'-exp')||{value:''}).value;
  var cat=tab==='permis'?((g('dm-permis-cat')||{value:''}).value):'';
  var today=new Date().toLocaleDateString('ar-DZ');
  var docs=JSON.parse(localStorage.getItem('ordo_docs_'+nin)||'{}');
  docs[tab]={num:num,exp:exp,savedAt:today};
  if(cat)docs[tab].cat=cat;
  localStorage.setItem('ordo_docs_'+nin,JSON.stringify(docs));
  if(num) s('wf-num',num);
  g('wtab-'+tab).classList.add('has-doc');
  g('badge-'+tab).classList.add('show');
  g('ddel-'+tab).style.display='flex';
  var dst=g('dst-'+tab);
  if(dst){dst.textContent='âœ“ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨ØªØ§Ø±ÙŠØ® '+today;dst.className='doc-st ok';dst.style.display='block';}
  s('ps-docs',Object.keys(docs).length);
  toast('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© âœ“');
}

// ============================================================
// SCAN PAGE
// ============================================================
function switchScan(doc,method,btn){
  var card=g('sc-'+doc);
  card.querySelectorAll('.sm').forEach(function(b){b.classList.remove('act');});
  btn.classList.add('act');
  card.querySelectorAll('.sv').forEach(function(v){v.classList.remove('act');});
  g('sv-'+doc+'-'+method).classList.add('act');
}
function dOver(e,el){e.preventDefault();el.classList.add('drag-over');}
function dLeave(el){el.classList.remove('drag-over');}

// Two-sided
function dDrop(e,doc,side){e.preventDefault();var f=e.dataTransfer.files[0];if(f)procFile(f,doc,side);}
function scanFile(input,doc,side){if(input.files[0])procFile(input.files[0],doc,side);}
function procFile(file,doc,side){
  if(file.size>8*1024*1024){toast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± (Ø£Ù‚ØµÙ‰ 8MB)','err');return;}
  var nin=(CU&&CU.nin)?CU.nin:'default';
  var r=new FileReader();
  r.onload=function(ev){
    var data=ev.target.result;
    if(!CACHE[doc])CACHE[doc]={};
    CACHE[doc][side]=data;
    dbPut(ik(nin,doc,side),data,function(ok){toast(ok?'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© âœ“':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸','err');});
    syncScanPreview(doc,side,data);
  };
  r.readAsDataURL(file);
}
function clearScan(doc,side){
  var nin=(CU&&CU.nin)?CU.nin:'default';
  if(CACHE[doc]) delete CACHE[doc][side];
  dbDel(ik(nin,doc,side));
  var suf='-'+side;
  var si=g('si-'+doc+suf), sp=g('sp-'+doc+suf), sf=g('sf-'+doc+suf);
  if(si)si.src=''; if(sp)sp.style.display='none'; if(sf)sf.value='';
  if(TAB===doc){ var face2=side==='back'?'back':'front'; setFace(face2,null); }
}

// Single-sided (chifa)
function dDropS(e,doc){e.preventDefault();var f=e.dataTransfer.files[0];if(f)procFileS(f,doc);}
function scanFileS(input,doc){if(input.files[0])procFileS(input.files[0],doc);}
function procFileS(file,doc){
  if(file.size>8*1024*1024){toast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± (Ø£Ù‚ØµÙ‰ 8MB)','err');return;}
  var nin=(CU&&CU.nin)?CU.nin:'default';
  var r=new FileReader();
  r.onload=function(ev){
    var data=ev.target.result;
    if(!CACHE[doc])CACHE[doc]={};
    CACHE[doc].img=data;
    dbPut(ik(nin,doc,'img'),data,function(ok){toast(ok?'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© âœ“':'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸','err');});
    var si=g('si-'+doc), sp=g('sp-'+doc);
    if(si)si.src=data; if(sp)sp.style.display='block';
    var dst=g('dst-'+doc);
    if(dst){dst.textContent='âœ“ ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ â€” Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø­ÙØ¸';dst.className='doc-st ok';dst.style.display='block';}
    if(TAB===doc) setFace('front',data);
  };
  r.readAsDataURL(file);
}
function clearScanS(doc){
  var nin=(CU&&CU.nin)?CU.nin:'default';
  if(CACHE[doc]) delete CACHE[doc].img;
  dbDel(ik(nin,doc,'img'));
  var si=g('si-'+doc), sp=g('sp-'+doc), sf=g('sf-'+doc), dst=g('dst-'+doc);
  if(si)si.src=''; if(sp)sp.style.display='none'; if(sf)sf.value=''; if(dst)dst.style.display='none';
  if(TAB===doc) setFace('front',null);
}

// Sync scan page preview from wallet upload
function syncScanPreview(doc,side,data){
  // Update scan page preview
  if(doc==='chifa'){
    var si=g('si-chifa'), sp=g('sp-chifa');
    if(si)si.src=data; if(sp)sp.style.display='block';
  } else {
    var si2=g('si-'+doc+'-'+side), sp2=g('sp-'+doc+'-'+side);
    if(si2)si2.src=data; if(sp2)sp2.style.display='block';
  }
  // Also update wallet card if viewing this doc
  if(TAB===doc){
    var face=(side==='back')?'back':'front';
    setFace(face,data);
  }
}

// Save metadata only (images already in IDB)
function saveDocMeta(doc){
  var nin=CU.nin, today=new Date().toLocaleDateString('ar-DZ');
  var num=(g('dm-'+doc+'-num')||{value:''}).value;
  var exp=(g('dm-'+doc+'-exp')||{value:''}).value;
  var cat=doc==='permis'?((g('dm-permis-cat')||{value:''}).value):'';
  var docs=JSON.parse(localStorage.getItem('ordo_docs_'+nin)||'{}');
  docs[doc]={num:num,exp:exp,savedAt:today};
  if(cat) docs[doc].cat=cat;
  localStorage.setItem('ordo_docs_'+nin,JSON.stringify(docs));
  var dst=g('dst-'+doc);
  if(dst){dst.textContent='âœ“ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨ØªØ§Ø±ÙŠØ® '+today;dst.className='doc-st ok';dst.style.display='block';}
  g('badge-'+doc).classList.add('show');
  g('ddel-'+doc).style.display='flex';
  g('wtab-'+doc).classList.add('has-doc');
  if(num&&TAB===doc) s('wf-num',num);
  s('ps-docs',Object.keys(docs).length);
  toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ“');
  ACTS.unshift({ico:'fas fa-id-card',bg:'rgba(27,94,66,.08)',c:'var(--g)',t:'Ø­ÙØ¸ ÙˆØ«ÙŠÙ‚Ø©',sub:doc,s:'sd',sl:'Ù…Ù†Ø¬Ø²'});
  if(ACTS.length>8)ACTS.pop(); renderActs();
}

function deleteDoc(doc){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ'))return;
  var nin=CU.nin;
  var docs=JSON.parse(localStorage.getItem('ordo_docs_'+nin)||'{}');
  delete docs[doc]; localStorage.setItem('ordo_docs_'+nin,JSON.stringify(docs));
  if(CACHE[doc]) CACHE[doc]={};
  if(doc==='chifa'){
    dbDel(ik(nin,'chifa','img')); clearScanS('chifa');
  } else {
    dbDel(ik(nin,doc,'front')); dbDel(ik(nin,doc,'back'));
    clearScan(doc,'front'); clearScan(doc,'back');
    if(doc==='permis') sv('dm-permis-cat','');
  }
  g('badge-'+doc).classList.remove('show'); g('ddel-'+doc).style.display='none';
  sv('dm-'+doc+'-num',''); sv('dm-'+doc+'-exp','');
  var dst=g('dst-'+doc); if(dst)dst.style.display='none';
  g('wtab-'+doc).classList.remove('has-doc');
  s('ps-docs',Object.keys(docs).length);
  if(TAB===doc) applyTab(doc,false);
  toast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©','err');
}

// ============================================================
// CAMERA
// ============================================================
var STREAMS={};
function openCam(doc){
  var vid=g('cam-'+doc), acts=g('ca-'+doc);
  navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}})
    .then(function(s){ STREAMS[doc]=s; vid.srcObject=s; vid.style.display='block'; if(acts)acts.style.display='flex'; })
    .catch(function(){ toast('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§','err'); });
}
function capPhoto(doc){
  var vid=g('cam-'+doc), cv=g('cv-'+doc);
  cv.width=vid.videoWidth; cv.height=vid.videoHeight;
  cv.getContext('2d').drawImage(vid,0,0);
  var data=cv.toDataURL('image/jpeg',.85);
  var nin=(CU&&CU.nin)?CU.nin:'default';
  if(doc==='chifa'){
    if(!CACHE.chifa) CACHE.chifa={};
    CACHE.chifa.img=data; dbPut(ik(nin,'chifa','img'),data);
    syncScanPreview('chifa','img',data);
    if(TAB==='chifa') setFace('front',data);
  } else {
    if(!CACHE[doc]) CACHE[doc]={};
    CACHE[doc].front=data; dbPut(ik(nin,doc,'front'),data);
    syncScanPreview(doc,'front',data);
    if(TAB===doc) setFace('front',data);
  }
  stopCam(doc); toast('ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØ­ÙØ¸Ù‡Ø§ âœ“');
}
function stopCam(doc){
  if(STREAMS[doc]){STREAMS[doc].getTracks().forEach(function(t){t.stop();});delete STREAMS[doc];}
  var vid=g('cam-'+doc), acts=g('ca-'+doc);
  if(vid)vid.style.display='none'; if(acts)acts.style.display='none';
}

// Multiple files
function multiFiles(input){
  var grid=g('other-grid');
  Array.from(input.files).forEach(function(file){
    var r=new FileReader();
    r.onload=function(ev){
      var div=document.createElement('div');
      div.style.cssText='position:relative;border-radius:10px;overflow:hidden;border:1px solid var(--b)';
      if(file.type.startsWith('image/')){
        div.innerHTML='<img src="'+ev.target.result+'" style="width:100%;height:110px;object-fit:cover;display:block"><div style="padding:.5rem;background:var(--w);font-size:.7rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+file.name+'</div>';
      } else {
        div.innerHTML='<div style="padding:1.5rem;text-align:center;background:var(--off)"><i class="fas fa-file-pdf" style="font-size:2rem;color:var(--red);display:block;margin-bottom:.5rem"></i><span style="font-size:.72rem;color:var(--muted)">'+file.name+'</span></div>';
      }
      grid.appendChild(div);
    };
    r.readAsDataURL(file);
  });
  toast('ØªÙ… ØªØ­Ù…ÙŠÙ„ '+input.files.length+' Ù…Ù„Ù');
}

// ============================================================
// AVATAR
// ============================================================
var PENDING_AV=null;
function openAvModal(){
  g('av-modal').classList.add('open');
  dbGet((CU.nin||'default')+'_avatar',function(d){
    if(d){ g('av-prev-img').src=d; g('av-prev-img').style.display='block'; g('av-ph').style.display='none'; g('av-save-btn').disabled=false; g('av-save-btn').style.opacity='1'; PENDING_AV=d; }
  });
}
function closeAvModal(){
  g('av-modal').classList.remove('open'); PENDING_AV=null;
  g('av-prev-img').src=''; g('av-prev-img').style.display='none';
  g('av-ph').style.display='block'; g('av-file').value='';
  g('av-save-btn').disabled=true; g('av-save-btn').style.opacity='.5';
}
function previewAv(input){
  if(!input.files[0])return;
  if(input.files[0].size>5*1024*1024){toast('Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© (Ø£Ù‚ØµÙ‰ 5MB)','err');return;}
  var r=new FileReader();
  r.onload=function(ev){
    PENDING_AV=ev.target.result;
    g('av-prev-img').src=PENDING_AV; g('av-prev-img').style.display='block'; g('av-ph').style.display='none';
    g('av-save-btn').disabled=false; g('av-save-btn').style.opacity='1';
  };
  r.readAsDataURL(input.files[0]);
}
function saveAv(){
  if(!PENDING_AV)return;
  dbPut((CU.nin||'default')+'_avatar',PENDING_AV,function(ok){
    if(ok){ applyAv(PENDING_AV); closeAvModal(); toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© âœ“'); }
    else   { toast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©','err'); }
  });
}
function applyAv(src){
  var sa=g('sb-av'), si=g('sb-av-img'), pa=g('p-av'), pi=g('p-av-img');
  if(sa)sa.style.display='none'; if(si){si.src=src;si.style.display='block';}
  if(pa)pa.style.display='none'; if(pi){pi.src=src;pi.style.display='block';}
}
document.addEventListener('click',function(e){ if(e.target===g('av-modal'))closeAvModal(); });
</script>

<div class="sb-overlay" id="__overlay" onclick="toggleSidebar()"></div>
<script>
function toggleSidebar(){
  var sb=document.querySelector('.sb'),ov=document.getElementById('__overlay');
  var open=sb.classList.toggle('mob-open');
  ov.style.display=open?'block':'none';
  document.body.style.overflow=open?'hidden':'';
}
document.querySelectorAll('.ni').forEach(function(ni){
  ni.addEventListener('click',function(){
    if(window.innerWidth<=900){
      document.querySelector('.sb').classList.remove('mob-open');
      document.getElementById('__overlay').style.display='none';
      document.body.style.overflow='';
    }
  });
});
</script>
</body>
</html>